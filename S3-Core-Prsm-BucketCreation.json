{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "S3-Core-Prsm-BucketCreation",
    "Parameters": {
        "RawBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-raw",
            "Description": "Enter Prism Bucket Name"
        },
        "ParsedBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-parsed",
            "Description": "Enter Prism Bucket Name"
        },
        "CuratedBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-curated",
            "Description": "Enter Prism Bucket Name"
        },
        "MDMBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-mdm",
            "Description": "Enter Prism Bucket Name"
        },
        "DevopsBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-devops",
            "Description": "Enter Prism Bucket Name"
        },
        "AthenaBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-athena",
            "Description": "Enter Prism Bucket Name"
        },
        "LogsBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-logs",
            "Description": "Enter Prism Bucket Name"
        },
        "RawTempBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-raw-temp",
            "Description": "Enter Prism Bucket Name"
        },
        "QASRawBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-qas-raw",
            "Description": "Enter Prism Bucket Name"
        },
        "AuditingBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-auditing",
            "Description": "Enter Prism Bucket Name"
        },
        "preprocessedBucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-raw-preprocessed",
            "Description": "Enter Prism Bucket Name"
        },
        "cat2Bucket": {
            "Type": "String",
            "Default": "imerys-glb-core-prsm-dev-raw-cat2",
            "Description": "Enter Prism Bucket Name"
        }		
		
    },
    "Resources": {
        "S3RawBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "RawBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "dev"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        },
        "S3ParsedBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "ParsedBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
				"LifecycleConfiguration": {
					"Rules": [
						{
						  "Id": "Parsed-Reject-folder-rule",
						  "Prefix": "reject",
						  "Status": "Enabled",
						  "ExpirationInDays": "7"
						}
					  ]
					},
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "dev"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        },
        "S3CuratedBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "CuratedBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
				"LifecycleConfiguration": {
				  "Rules": [
					{
					  "Id": "curated-reject-folder-rule",
					  "Prefix": "reject",
					  "Status": "Enabled",
					  "ExpirationInDays": "5"
					},									  
					{
					  "Id": "curated-dwh-folder-rule",
					  "Prefix": "DWH",
					  "Status": "Enabled",
					  "ExpirationInDays": "1825",
					  "Transitions": [
						{
						  "TransitionInDays": "30",
						  "StorageClass": "STANDARD_IA"
						},
						{
						  "TransitionInDays": "90",
						  "StorageClass": "Glacier"
						}						
					  ]
					}
				  ]
				},				
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "CuratedBucket"
                    }
                ]
            }
        },
        "S3MDMBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "MDMBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "dev"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        },
        "S3DevopsBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "DevopsBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "dev"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        },
        "S3AthenaBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "AthenaBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                }
            }
        },
        "S3LogsBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "LogsBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
				"LifecycleConfiguration": {
					  "Rules": [
						{
						  "Id": "Logs-bucket-rule",
						  "Status": "Enabled",
						  "ExpirationInDays": "7"
						}
					  ]
					},				
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "dev"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        },
        "S3RawTempBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "RawTempBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "dev"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        },
        "S3QASRawBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "QASRawBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "qas"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        },
        "S3AuditingBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "AuditingBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "dev"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        },
        "S3preprocessedBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "preprocessedBucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",				
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "dev"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        },
        "S3cat2Bucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "cat2Bucket"
                },
                "PublicAccessBlockConfiguration": {
                    "BlockPublicAcls": true,
                    "BlockPublicPolicy": true,
                    "IgnorePublicAcls": true,
                    "RestrictPublicBuckets": true
                },
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "AccessControl": "Private",
                "Tags": [
                    {
                        "Key": "glb-core-env",
                        "Value": "dev"
                    },
                    {
                        "Key": "glb-core-project",
                        "Value": "prism"
                    }
                ]
            }
        }		
    },
    "Outputs": {
        "RawBucket": {
            "Value": {
                "Ref": "S3RawBucket"
            }
        },
        "ParsedBucket": {
            "Value": {
                "Ref": "S3ParsedBucket"
            }
        },
        "CuratedBucket": {
            "Value": {
                "Ref": "S3CuratedBucket"
            }
        },
        "MDMBucket": {
            "Value": {
                "Ref": "S3MDMBucket"
            }
        },
        "DevopsBucket": {
            "Value": {
                "Ref": "S3DevopsBucket"
            }
        },
        "AthenaBucket": {
            "Value": {
                "Ref": "S3AthenaBucket"
            }
        },
        "LogsBucket": {
            "Value": {
                "Ref": "S3LogsBucket"
            }
        },
        "RawTempBucket": {
            "Value": {
                "Ref": "S3RawTempBucket"
            }
        },
        "QASRawBucket": {
            "Value": {
                "Ref": "S3QASRawBucket"
            }
        },
        "AuditingBucket": {
            "Value": {
                "Ref": "S3AuditingBucket"
            }
        },
        "preprocessedBucket": {
            "Value": {
                "Ref": "S3preprocessedBucket"
            }
        },
        "cat2Bucket": {
            "Value": {
                "Ref": "S3cat2Bucket"
            }
        }		
    }
}